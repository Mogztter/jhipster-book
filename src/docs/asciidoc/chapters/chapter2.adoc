When I started writing this book, I had a few different ideas for a sample application. My first idea involved creating
a photo gallery to showcase the 1996 VW Bus I've been working on for over 10 years. The project is almost finished and
I wanted a website to show how things have progressed through the years. I also thought about creating a blog application.
As part of http://raibledesigns.com/rd/entry/getting_hip_with_jhipster_at[my first presentation on JHipster] (at Denver's
Java User Group), I created a blog application that I live-coded to the audience. After that presentation, I spent
several hours polishing the application and started http://www.jhipster-book.com[www.jhipster-book.com] with it.

After thinking about the VW Bus Gallery and developing the blog application, I thought to myself "is this hip enough?"
Shouldn't a book about becoming a Java Hipster show how to build a hip application?

I wrote to Julien Dubois, founder of JHipster, and Dennis Sharpe, the technical editor for this book and asked them
their thoughts. We went back and forth on a few ideas: a gitter.im clone, a job board for Java hipsters, a shopping cart
app. Then it hit me, there was an I'd been wanting to develop for a while.

It's basically an app that you can use to monitor their health. In late September through mid-October 2014, I'd done a
"sugar detox" where I stopped eating sugar, started exercising regularly and stopped drinking alcohol. I'd had high blood
pressure for over 10 years and was on blood pressure medication at the time. During the first week of the detox, I ran
out of blood pressure medication. Since getting a new prescription required a doctors visit, I decided I'd wait until
after the detox to do so. After three weeks, not only did I lose 15 pounds, but my blood pressure was at normal levels!

Before I started the detox, I came up with a 21-point system to see how healthy I was being each week. Its rules were
simple: you can earn up to three points per day, for the following reasons:

1. If you eat healthy, you get a point. Otherwise, zero.
2. If you exercise, you get a point.
3. If you don't drink alcohol, you get a point.

I was surprised to find I got eight points the first week I used this system. During the detox, I got 16 points the
first week, 20 the second and 21 the third. Before the detox, I thought eating healthy meant eating anything but
fast food. After the detox, I realized that _eating healthy_ meant eating no sugar for me. I'm also a big craft
beer lover, so I've modified the alcohol rule to allow two healthier alcohol drinks per day (like a greyhound or
red wine).

My point goal per week is 15. I find that if I get above it, I'll likely lose weight and have good blood pressure. If I
get below 15, I risk getting sick. I've been tracking my health like this since September 2014. I've lost 30 pounds and
my blood pressure has returned to normal levels. I haven't had good blood pressure since my early 20s, so this has been
a life-changer for me.

I thought writing a "21-Point Health" application this would be hip because tracking your health is becoming more
important. With wearables that can track it for you, I might be able to create some APIs or hooks that can auto-record
points for a day. Imagine hooking into dailymile.com (where I track my exercise) or Untappd (where I sometimes checkin
the beers I drink). Or even displaying other activities for a day (e.g. showing your blood pressure score that you keep on
bettir.com).

I thought it'd fit nicely with JHipster and Spring Boot from a monitoring standpoint. Spring Boot has lots of health
monitors for your app, now you can use this JHipster app to monitor your health!

This chapter has five different sections:

1. Creating the application.
2. Building the UI and business logic.
3. Load Testing.
4. Deployment.
5. Monitoring and Analytics.

[red]#3-5 are covered in Chapter 5 as well, not sure if they should be covered here.#

=== Creating the application

I started using the http://jhipster.github.io/installation.html[Installing JHipster] instructions. I'm a Java Developer,
so I already had Java 8 installed, as well as Maven and Git. I installed Node.js from https://nodejs.org/[nodejs.org], then
ran the following commands to install http://yeoman.io/[Yeoman] and http://bower.io/[Bower].

[source]
----
npm install -g yo
npm install -g bower
----

I also installed Grunt and JHipster.

[source]
----
npm install -g grunt-cli
npm install -g generator-jhipster
----

Then I proceeded to build my application. Unlike many application generators in Javaland, Yeoman expects you to be
in the directory you want to create your project in, rather than creating the directory for you. So I created a `21-points`
directory and typed in the following command to invoke JHipster.

[source]
----
yo jhipster
----

After running this command, I was prompted to answer questions about how I wanted my application to be generated. You can
see the choices I made in <<img-generating-21points>>.

[[img-generating-21points]]
.Generating the application
image::chapter2/generating-21points.png[Generating the application, 1416, scaledwidth="100%"]

You can see that I chose PostgreSQL as my development and production database. The reason I did this is because using a
non-embedded database (like H2) offers some important benefits.

* Your data is retained when restarting the application.
* Your application starts a bit faster.
* You can use Liquibase to generate a database changelog.

http://www.liquibase.org/[Liquibase] is described as source control for your database. It will help create new fields as
you add them to your entities. It will also refactoring your database, for example creating tables and dropping columns.
It also has the ability to undo changes to your database, either automatically or with custom SQL.

After answering all the questions, JHipster created a whole bunch of files (272 in this case), then ran `npm install`
followed by `bower install`. To prove everything was good-to-go, I ran the unit tests using `grunt test`.

Next, I installed http://postgresapp.com/[Postgres.app] and tried creating a local PostgreSQL database. You can see in
<<img-create-local-db>> that PostgreSQL didn't like the numbers that started my database name.

*[red]#Question: Would this be better as a code listing? Then people could copy and paste.#*

[[img-create-local-db]]
.Creating local database
image::chapter2/creating-local-db.png[Creating local database, 1686, scaledwidth="100%"]

I chose the name _health_ instead and updated `src/main/resources/config/application-dev.yml` to use this name and the
specified credentials.

[source,diff]
----
     datasource:
         dataSourceClassName: org.postgresql.ds.PGSimpleDataSource
-        url:
-        databaseName: 21points
-        serverName: localhost
-        username: 21points
-        password:
+        url: jdbc:postgresql://localhost/health
+        username: health
+        password: health
----

==== Adding Source Control

One of the first things I like to do when creating a new project is to add it to a Version Control System (VCS). In this
particular case, I chose Git and Bitbucket. The following commands show how I initialized Git, committed the project,
added a reference to the remote Bitbucket repository, then pushed everything.

[source]
----
[mraible:~/dev/21-points] 128 $ git init
Initialized empty Git repository in /Users/mraible/dev/21-points/.git/

[mraible:~/dev/21-points] $ git add -A

[mraible:~/dev/21-points] $ git commit -m "Initial checkin of 21-points application"
[master (root-commit) c20f856] Initial checkin of 21-points application
 274 files changed, 13179 insertions(+)
 ...

[mraible:~/dev/21-points] $ git push origin master
Counting objects: 382, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (353/353), done.
Writing objects: 100% (382/382), 242.01 KiB | 0 bytes/s, done.
Total 382 (delta 55), reused 0 (delta 0)
To git@bitbucket.org:mraible/21-points.git
 * [new branch]      master -> master
----

This section showed you how I created a new application with JHipster and checked it into source control. If you're
creating an application following similar steps, I believe there's two common approaches for continuing. The first
involves developing the application, then testing and deploying. The second option is to setup continuous integration,
deploy, then begin development and testing. In a team development environment, I recommend following the second option.
However, since you're likely reading this as an individual, I'll follow the first approach and get right to coding.
If you're interested in setting up continuous integration with Jenkins, please see
http://www.jhipster-book.com/#!/news/entry/building-and-deploying-a-jhipster-app-with-jenkins[Building and Deploying a JHipster App with Jenkins].

=== Building the UI and business logic
I wanted 21 Points to be a bit more hip than a stock JHipster application. Bootstrap was all the rage a couple years ago,
but now Google's https://www.google.com/design/[Material Design] is growing in popularity. I searched and found a
https://fezvrasta.github.io/bootstrap-material-design/[Material Design for Bootstrap] theme. To install it, I executed
the following command:

[source]
----
bower install bootstrap-material-design --save
----

After this completed, I ran `grunt wiredep` to add the new CSS and JavaScript dependencies to `src/main/webapp/index.html`.
The https://github.com/taptapship/wiredep[wiredep] task updates files that refer to Bower dependencies for you. In this case,
`src/main/webapp/index.html` and `src/test/javascript/karma.conf.js`.

Then I followed the theme's Getting Started guide and added the following initialization code to the bottom of the page.

[source,html]
----
<script>
    $.material.init()
</script>
----

Finally, I ran `./gradlew bootRun` and confirmed the new theme was being used.

[[img-material-design-theme]]
.Material Design for Bootstrap Theme
image::chapter2/material-design-theme.png[Material Design for Bootstrap, 2492, scaledwidth="100%"]

Before creating the entities and associated database tables for this application, I decided to upgrade JHipster to
the latest release. You can see that I created this application with JHipster 2.16.0. The latest release is now
2.19.0, so I updated my version with the following command.

----
npm update -g generator-jhipster
----

This installs the latest version of JHipster, but does nothing to upgrade my project. I had to run the following
command to update the project.

----
yo jhipster
----

This notified me that it was deleting a number of files, and there were some conflicts in my files.footnote:[If you
don't see conflicts when upgrading, it's possible you never installed JHipster on the machine you're using. I found
this when switching machines. Check `package.json` to ensure it has the new version number. If it does not, run \
`npm install -g generator-jhipster`.]

----
This is an existing project, using the configuration from your .yo-rc.json file
to re-generate the project...

Remove the file - src/test/javascript/spec/app/account/health/healthControllerSpec.js
Remove the file - src/test/javascript/spec/app/account/login/loginControllerSpec.js
Remove the file - src/test/javascript/spec/app/account/password/passwordControllerSpec.js
Remove the file - src/test/javascript/spec/app/account/password/passwordDirectiveSpec.js
Remove the file - src/test/javascript/spec/app/account/sessions/sessionsControllerSpec.js
Remove the file - src/test/javascript/spec/app/account/settings/settingsControllerSpec.js
Remove the file - src/test/javascript/spec/components/auth/authServicesSpec.js
 conflict bower.json
? Overwrite bower.json? (Ynaxdh)
----

I answered "Y" to all the conflict questions. Because I had the files in source control, I was able to diff the changes
after they were made and decide if I wanted them or not. Most changes were welcome, but I wanted to keep my theme changes,
so I had to add the following back into `bower.json` and run `bower install` again.

[source,javascript]
----
"bootstrap-material-design": "~0.3.0"
----

I still needed to manually restore the call to initialize the Material Design theme at the bottom of `index.html`.

[source,html]
----
<script>
    $.material.init()
</script>
----

I ran `grunt serve` to verify everything looked good, then committed my updated project to Git.

==== Generating Entities

For each entity you want to create, you will need:

* A database table
* A Liquibase change set
* A JPA Entity class
* A Spring Data JPA Respository interface
* A Spring MVC Rest Controller
* An AngularJS router, controller and service
* An HTML page

In addition, you should have integration tests to verify everything works, and performance tests to verify it's fast. In
an ideal world, you'd also have unit tests and integration tests for your Angular code.

The good news is JHipster can generate all of this code for you, including integration tests and performance tests. At the
time of this writing, it does not support generating UI tests.footnote:[See https://github.com/jhipster/generator-jhipster/issues/897[issue #897]
for more information on why UI testing is not supported.]
In addition, if you have entities with relationships, it will generate the necessary schema to support them (with foreign keys)
and the JavaScript and HTML code to manage them. Validation can also be setup to require certain fields, as well as control their length.

JHipster supports two methods of code generation. The first is using its
https://jhipster.github.io/creating_an_entity.html[entity sub-generator]. The entity sub-generator is a command-line tool
that prompts you with questions and you provide the answers. https://jhipster.github.io/jhipster_uml.html[JHipster UML]
is an alternative for those that like visual tools. UML Editors supported include https://www.modeliosoft.com/[Modelio],
http://www.umldesigner.org/[UML Designer], https://www.genmymodel.com/[GenMyModel] and
http://www.visual-paradigm.com/[Visual Paradigm]. Because I believe the entity sub-generation is simpler to use, I chose
it for this project.

The <<img-entity-diagram>> shows the data model for this project. A user has a goal, which is tied to metrics
and a daily log of activities. The activities could be further abstracted so they're not explicitly exercise, meals and
alcohol, but it's important to start somewhere, not get it right the first time.

[[img-entity-diagram]]
.21-Point Health Entity Diagram
image::chapter2/entity-diagram.png[21-Point Health Entity Diagram, 684, scaledwidth="75%", align="center"]

The most important thing to remember when generating entities with JHipster is you must generate the entity that
owns the relationship first. In this application, the `Metric` entity is owned by `Goal` and `Entry`, so we'll generate
that one first. The relationships could be simplified to only track metrics for the entry, but then it'd be difficult
to relate that back to the goal and display progress. <<img-entity-diagram-simple>> is a simplified version, without
a relationship of metrics to goals. For more information, see
https://jhipster.github.io/managing_relationships.html[Managing Relationships with JHipster].

[[img-entity-diagram-simple]]
.Simple Entity Diagram
image::chapter2/entity-diagram-simple.png[Simple Entity Diagram, 684, scaledwidth="75%", align="center"]

I started by generating a `Goal` entity, with a many-to-one relationship with `User`. Below are the questions and
answers I used to generate this entity.

----
$ yo jhipster:entity Goal
The entity Goal is being created.
Generating field #1
? Do you want to add a field to your entity? Yes
? What is the name of your field? name
? What is the type of your field? String
? Do you want to add validation rules to your field? Yes
? Which validation rules do you want to add? Required, Minimum length
? What is the minimum length of your field? 10
=================Goal=================
name (String) required minlength='10'
Generating field #2
? Do you want to add a field to your entity? Yes
? What is the name of your field? description
? What is the type of your field? String
? Do you want to add validation rules to your field? No
=================Goal=================
name (String) required minlength='10'
description (String)
Generating field #3
? Do you want to add a field to your entity? No
=================Goal=================
name (String) required minlength='10'
description (String)
Generating relationships with other entities
? Do you want to add a relationship to another entity? Yes
? What is the name of the other entity? user
? What is the name of the relationship? user
? What is the type of the relationship? many-to-one
? When you display this relationship with AngularJS, which field from 'user' do you want to use? id
===========Goal==============
name (String)
description (String)
-------------------
user - user (many-to-one)
Generating relationships with other entities
? Do you want to add a relationship to another entity? No
===========Goal==============
name (String)
description (String)
-------------------
user - user (many-to-one)
? Do you want pagination on your entity? No
----

:icons: font
NOTE: I didn't add any pagination because I've been tracking my goals quarterly. I may add it at a later
date after I've been using this app for a while.

After answering the last question, the files to create/read/update/delete this entity were generated.

----
Everything is configured, generating the entity...
   create .jhipster/Goal.json
   create src/main/java/org/jhipster/health/domain/Goal.java
   create src/main/java/org/jhipster/health/repository/GoalRepository.java
   create src/main/java/org/jhipster/health/repository/search/GoalSearchRepository.java
   create src/main/java/org/jhipster/health/web/rest/GoalResource.java
   create src/main/resources/config/liquibase/changelog/20150811180009_added_entity_Goal.xml
   create src/main/webapp/scripts/app/entities/goal/goals.html
   create src/main/webapp/scripts/app/entities/goal/goal-detail.html
   create src/main/webapp/scripts/app/entities/goal/goal.js
   create src/main/webapp/scripts/app/entities/goal/goal.controller.js
   create src/main/webapp/scripts/app/entities/goal/goal-detail.controller.js
   create src/main/webapp/scripts/components/entities/goal/goal.service.js
   create src/main/webapp/scripts/components/entities/goal/goal.search.service.js
   create src/test/java/org/jhipster/health/web/rest/GoalResourceTest.java
   create src/test/gatling/simulations/GoalGatlingTest.scala
   create src/main/webapp/i18n/en/goal.json
   create src/main/webapp/i18n/fr/goal.json
----

Next, I proceeded to generate the `Metric` entity, with a many-to-many relationship to `Entry`.

:icons: font
NOTE: When trying to use `value`, JHipster warned me this was a reserved word in PostgreSQL, so I used `amount` instead.

----
$ yo jhipster:entity Metric
The entity Metric is being created.
Generating field #1
? Do you want to add a field to your entity? Yes
? What is the name of your field? name
? What is the type of your field? String
? Do you want to add validation rules to your field? Yes
? Which validation rules do you want to add? Required, Minimum length
? What is the minimum length of your field? 2
=================Metric=================
name (String) required minlength='2'
Generating field #2
? Do you want to add a field to your entity? Yes
? What is the name of your field? amount
? What is the type of your field? String
? Do you want to add validation rules to your field? Yes
? Which validation rules do you want to add? Required
=================Metric=================
name (String) required minlength='2'
amount (String) required
Generating field #3
? Do you want to add a field to your entity? No
=================Metric=================
name (String) required minlength='2'
amount (String) required
Generating relationships with other entities
? Do you want to add a relationship to another entity? Yes
? What is the name of the other entity? entry
? What is the name of the relationship? entry
? What is the type of the relationship? many-to-many
? Is this entity the owner of the relationship? No
===========Metric==============
name (String)
amount (String)
-------------------
entry - entry (many-to-many)
Generating relationships with other entities
? Do you want to add a relationship to another entity? Yes
? What is the name of the other entity? goal
? What is the name of the relationship? goal
? What is the type of the relationship? many-to-many
? Is this entity the owner of the relationship? No
===========Metric==============
name (String)
amount (String)
-------------------
entry - entry (many-to-many)
goal - goal (many-to-many)
Generating relationships with other entities
? Do you want to add a relationship to another entity? No
===========Metric==============
name (String)
amount (String)
-------------------
entry - entry (many-to-many)
goal - goal (many-to-many)
? Do you want pagination on your entity? Yes, with pagination links
----

Finally, I created the `Entry`, with a many-to-one relationship to `Goal` and `Metric`. Rather than showing you all
the questions and answers, I'll explain it in simple terms. I made the `date` a `LocalDate` that's required, the individual
point fields as Integers, and `notes` a String that's not required. JHipster showed me the following output before generating
everything.

----
===========Entry==============
date (LocalDate)
exercise (Integer)
meals (Integer)
alcohol (Integer)
notes (String)
-------------------
goal - goal (many-to-one)
metric - metric (many-to-many)
? Do you want pagination on your entity? Yes, with infinite scroll
----

To ensure that everything was generated correctly, I ran `./gradlew test`. I received numerous failures, many of them looking
similar to the following.

----
org.jhipster.health.web.rest.UserResourceTest > testGetExistingUser FAILED
    java.lang.IllegalStateException
        Caused by: org.springframework.beans.factory.BeanCreationException
            Caused by: javax.persistence.PersistenceException
                Caused by: org.hibernate.AnnotationException
----

I opened `build/reports/tests/index.html` to investigate further and found the following error:

----
Caused by: org.hibernate.AnnotationException: mappedBy reference an unknown target entity property:
  org.jhipster.health.domain.Goal.metrics in org.jhipster.health.domain.Metric.goals
----

I determined this was caused by generating the `Goal` entity without the relationship to `Metric`. So I added
the following Java code to `Goal.java` and ran `./gradlew liquibaseDiffChangelog`.

[source,java]
----
@ManyToMany
@Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE)
@JoinTable(name = "GOAL_METRIC",
    joinColumns = @JoinColumn(name="goals_id", referencedColumnName="ID"),
    inverseJoinColumns = @JoinColumn(name="metrics_id", referencedColumnName="ID"))
private Set<Metric> metrics = new HashSet<>();

public Set<Metric> getMetrics() {
    return metrics;
}

public void setMetrics(Set<Metric> metrics) {
    this.metrics = metrics;
}
----

I had to update `liquibase.gradle` to use the same datasource settings I had in `application-dev.yaml` before this
command worked. After Liquibase completed successfully, I added the generated file to
`src/main/resources/config/liquibase/master.xml`.

[source,xml]
----
<include file="classpath:config/liquibase/changelog/20150811124815_changelog.xml" relativeToChangelogFile="false"/>
----

I then ran `./gradlew test` again. This time, they failed with the following reason:

----
liquibase.exception.DatabaseException: org.h2.jdbc.JdbcSQLException: Table "ENTRY" already exists
----

At this moment, I realized that Liquibase was diffing against my "dev" database, while my tests where hitting my "test" (H2)
database. When I ran Liquibase's diff command, it was looking at my "dev" database, where no tables had been created yet.
To solve this, I removed the changelog reference in `master.xml`, commented out the newly added code in `Goal.java`, and
ran `./gradlew bootRun` to generate the initial tables in my "dev" database. Of course, this failed with the same
`mappedBy reference` error, but my schema did get created and I ran `./gradlew liquibaseDiffChangelog` again. After adding
the generated file to `master.xml`, I was pleased to see my tests passed.

----
BUILD SUCCESSFUL

Total time: 51.422 secs
----

I ran `grunt test` to ensure my UI tests were good to go, then fired up the app and tried everything out. The biggest
issue I noticed was that when you created a `Goal`, it showed the ids of the users instead of their name.

[[img-create-goal-user-id]]
.Create Goal with User Id
image::chapter2/create-goal-user-id.png[Create Goal with User Id, 800, scaledwidth="66%", align="center"]

Since the id doesn't provide much information, I changed this to display the user's username instead. In JHipster's
`User.java`, this field is called `login`. To make this change, I modified `.jhipster/Goal.json` and changed its
`otherEntityField` from having a value of `id` to `login`.

[source,json]
----
"relationships": [
    {
        "relationshipId": 1,
        "relationshipName": "user",
        "relationshipNameCapitalized": "User",
        "relationshipFieldName": "user",
        "otherEntityName": "user",
        "relationshipType": "many-to-one",
        "otherEntityNameCapitalized": "User",
        "otherEntityField": "login"
    }
]
----

After making this change, I ran `yo jhipster:entity goal` to regenerate `Goal.java` and its associated UI. Since I'd
modified `Goal.java`, when prompted to overwrite this file, I answered "No".

----
 conflict src/main/java/org/jhipster/health/domain/Goal.java
? Overwrite src/main/java/org/jhipster/health/domain/Goal.java? do not overwrite
     skip src/main/java/org/jhipster/health/domain/Goal.java
----

After restarting everything, I was pleased to see the "user" dropdown contained the `login` field instead of id.

[[img-create-goal-user-login]]
.Create Goal with User Login
image::chapter2/create-goal-user-login.png[Create Goal with User Login, 800, scaledwidth="66%", align="center"]

After making this change and regenerating everything, I realized there was an easier way. In `goal-dialog.html`, the
following code existed to display the dropdown of users.

[source,html]
----
<select class="form-control" id="field_user" name="user" ng-model="goal.user.id" ng-options="user.id as user.id for user in users">
----

To modify it to display `user.login` instead, I simply needed to change `ng-options` and its _as_ expression to the following.

[source,html]
----
<select class="form-control" id="field_user" name="user" ng-model="goal.user.id" ng-options="user.id as user.login for user in users">
----

At this point, I added all the generated files to Git, committed and pushed. I noticed that 54 files had been generated
by JHipster. What a time saver!

*[red]#Question: I like how this section shows the evolution of designing/architecting an application. Would it be
better for the reader if there were no mistakes and the design was correct at the beginning? I could turn the first
part of this section into a blog post if you think so.#*

Next, I started to play around with my newly created app to see if it had the functionality I wanted. I was hoping to
easily enter daily entries about whether I'd exercised, ate healthy meals or consumed beer. I also wanted to record
my weight and blood pressure metrics when I measured them. When I started using the UI I'd just created, it seemed
like it _might_ be able to accomplish these goals, but also seemed somewhat cumbersome. That's when I decided to create
a UI mockup with the main screen and its ancillary screens for data entry. I used
https://www.omnigroup.com/omnigraffle[OmniGraffle] and a
https://viget.com/inspire/twitter-bootstrap-3.0-stencils-for-omnigraffle[Bootstrap stencil] to create a
<<img-ui-mockup>>.

[[img-ui-mockup]]
.UI Mockup
image::chapter2/ui-mockup.png[Simple Entity Diagram, 846, scaledwidth="75%", align="center"]

==== Starting over with a Straightfoward Design
After figuring out how I wanted the UI to look, I realized my data model could be simplified. Before, it was quite generic
and could handle a number of metrics. In my new design, I realized I didn't need to track high-level goals (e.g. lose
five pounds in Q4 2015). I was more concerned with tracking weekly goals and _21 Points_ is all about how many points you
get in a week. I was grateful that JHipster allowed me to quickly see the flaws in my design, then simplify. I created
<<img-entity-diagram-simpler>> as my new data model.

[[img-entity-diagram-simpler]]
.21-Point Health Entity Diagram - Simplified
image::chapter2/entity-diagram-simpler.png[21-Point Health Entity Diagram - Simplified, 684, scaledwidth="100%", align="center"]

JHipster created 54 files when generating the previous data model, REST controllers and UI. Rather than hunting down all
these files and deleting them, I reverted to the last commit before them in Git.footnote:[If this doesn't work for you,
see http://stackoverflow.com/a/28921195/65681[this Stack Overflow answer] for a list of what files to delete.]
This is the beauty of using a version control system.

----
$ git reset --hard 8ad48eb
HEAD is now at 8ad48eb Upgraded to JHipster 2.19.0.
----

I also dropped and re-created my local PostgreSQL database.

----
mraible=# drop database health;
DROP DATABASE
mraible=# create database health;
CREATE DATABASE
mraible=# grant all privileges on database health to health;
GRANT
----

Then I ran `yo jhipster:entity points`. I added the appropriate fields, their validation rules and specified a many-to-one
relationship with `User`. Below is the final output from my answers.

----
===========Points==============
date (LocalDate)
exercise (Integer)
meals (Integer)
alcohol (Integer)
notes (String)
-------------------
user - user (many-to-one)
? Do you want to use a Data Transfer Object (DTO)? No, use the entity directly
? Do you want pagination on your entity? Yes, with infinite scroll
Everything is configured, generating the entity...
   create .jhipster/Points.json
   create src/main/java/org/jhipster/health/domain/Points.java
   create src/main/java/org/jhipster/health/repository/PointsRepository.java
   create src/main/java/org/jhipster/health/repository/search/PointsSearchRepository.java
   create src/main/java/org/jhipster/health/web/rest/PointsResource.java
   create src/main/resources/config/liquibase/changelog/20150818154309_added_entity_Points.xml
   create src/main/webapp/scripts/app/entities/points/pointss.html
   create src/main/webapp/scripts/app/entities/points/points-detail.html
   create src/main/webapp/scripts/app/entities/points/points-dialog.html
   create src/main/webapp/scripts/app/entities/points/points.js
   create src/main/webapp/scripts/app/entities/points/points.controller.js
   create src/main/webapp/scripts/app/entities/points/points-dialog.controller.js
   create src/main/webapp/scripts/app/entities/points/points-detail.controller.js
   create src/main/webapp/scripts/components/entities/points/points.service.js
   create src/main/webapp/scripts/components/entities/points/points.search.service.js
   create src/test/java/org/jhipster/health/web/rest/PointsResourceTest.java
   create src/test/gatling/simulations/PointsGatlingTest.scala
   create src/main/webapp/i18n/en/points.json
   create src/main/webapp/i18n/fr/points.json
----

I had similar answers for the `Weight` and `BloodPressure` entities. For `Settings`, I created a one-to-one relationship
with `User`. I learned that _settings_ is a reserved keywork, so used _preferences_ instead.

----
$ yo jhipster:entity settings
The entity name cannot contain a JHipster reserved keyword
----

To ensure people used 21 Point Health effectively, I made the minimum weekly goal 10 points and set a max of 21. I also
made the `weightUnits` property an enum.

----
=================Preferences=================
weekly_goal (Integer) required min='10' max='21'
Generating field #2
? Do you want to add a field to your entity? Yes
? What is the name of your field? weight_units
? What is the type of your field? Enumeration (Java enum type)
? What is the class name of your enumeration? Units
? What are the values of your enumeration (separated by comma)? kg,lb
? Do you want to add validation rules to your field? Yes
? Which validation rules do you want to add? Required
=================Preferences=================
weekly_goal (Integer) required min='10' max='21'
weight_units (Units) required
----

:icons: font
NOTE: After generating the `Weight` and `BloodPressure` entities with a `date` property for their date/time field, I
decided that `timestamp` was a better property name. To fix this, I modified their respective JSON files in the `.jhipster`
directory and ran `yo jhipster:entity` for each entity again. This seemed easier than refactoring with IntelliJ and hoping
it caught all the name instances.

When I ran `./gradlew test`, I received an error about `User` not containing the `preferences` property.

----
Caused by: org.hibernate.AnnotationException: Unknown mappedBy in: org.jhipster.health.domain.Preferences.user,
referenced property unknown: org.jhipster.health.domain.User.preferences
----

I fixed this by adding a `@OneToOne` mapping to `User.java`:

[source,java]
----
@OneToOne
@JsonIgnore
private Preferences preferences;

public Preferences getPreferences() {
    return preferences;
}

public void setPreferences(Preferences preferences) {
    this.preferences = preferences;
}
----

I then ran `./gradlew liquibaseDiffChangelog` to generate the changelog and added the XML in the generated file to
`*_added_entity_Preferences.xml`.

[source,xml]
----
<!-- Added the preferences field to User -->
<changeSet author="mraible (generated)" id="1439916664921-1">
    <addColumn tableName="JHI_USER">
        <column name="preferences_id" type="int8"/>
    </addColumn>
</changeSet>
<changeSet author="mraible (generated)" id="1439916664921-2">
    <addForeignKeyConstraint baseColumnNames="preferences_id" baseTableName="JHI_USER"
                             constraintName="FK_1r5e40mq4hwtlyd9lemghc8su"
                             deferrable="false" initiallyDeferred="false"
                             referencedColumnNames="id"
                             referencedTableName="PREFERENCES"/>
</changeSet>
----

:icons: font
NOTE: I did have to modify the datasource settings in `liquibase.gradle` again since `git reset` reverted that change.

When I ran `./gradlew test`, I saw some failures, but these were for old tests that I'd already deleted. I
https://github.com/jhipster/generator-jhipster/issues/1886[opened a ticket] with the JHipster project to track this
issue.

I checked in 6 changed files and 78 new files generated by the JHipster before continuing to implement my UI mockups.

=== UI Improvements

Add Changelog here

- Changed Pointss to Points
- Etc.

==== Testing

=== Load Testing

=== Deploy it!

[mraible:~/dev/21-points] 2s $ heroku login
Enter your Heroku credentials.
Email: matt@raibledesigns.com
Password (typing will be hidden):
Authentication successful.
⌁23% [mraible:~/dev/21-points] 18s $ yo jhipster:heroku
Heroku configuration is starting
? Name to deploy as: 21points
? On which region do you want to deploy ? us

Using existing Git repository

Installing Heroku CLI deployment plugin
Installing https://github.com/heroku/heroku-deploy...
done


Creating Heroku application and setting up node environment
heroku create 21points --addons heroku-postgresql:hobby-dev
✖ { [Error: Command failed: /bin/sh -c heroku create 21points --addons heroku-postgresql:hobby-dev
 !    Name must start with a letter and can only contain lowercase letters, numbers, and dashes.
]
  killed: false,
  code: 1,
  signal: null,
  cmd: '/bin/sh -c heroku create 21points --addons heroku-postgresql:hobby-dev' }
⌁22% [mraible:~/dev/21-points] 13s $ yo jhipster:heroku
Heroku configuration is starting
? Name to deploy as: health
? On which region do you want to deploy ? us

Using existing Git repository

Installing Heroku CLI deployment plugin
Installing https://github.com/heroku/heroku-deploy...
done


Creating Heroku application and setting up node environment
heroku create health --addons heroku-postgresql:hobby-dev

? The Heroku app "health" already exists! Use it anyways?
❯ Yes, I have access to it
  No, generate a random name

⌁22% [mraible:~/dev/21-points] 32s $ yo jhipster:heroku
Heroku configuration is starting
? Name to deploy as: 21-point-health
? On which region do you want to deploy ? us

Using existing Git repository

Installing Heroku CLI deployment plugin
Installing https://github.com/heroku/heroku-deploy...
^C
⌁22% [mraible:~/dev/21-points] 26s 130 $ yo jhipster:heroku
Heroku configuration is starting
? Name to deploy as: health-by-points
? On which region do you want to deploy ? us

Using existing Git repository

Installing Heroku CLI deployment plugin
Installing https://github.com/heroku/heroku-deploy...
done


Creating Heroku application and setting up node environment
heroku create health-by-points --addons heroku-postgresql:hobby-dev
Creating health-by-points... done, stack is cedar-14

Adding heroku-postgresql:hobby-dev to health-by-points...
done

https://health-by-points.herokuapp.com/ | https://git.heroku.com/health-by-points.git

Git remote heroku added


Creating Heroku deployment files

Building application
:generateMainMapperClasses

Download https://oss.sonatype.org/content/repositories/releases/io/dropwizard/metrics/metrics-healthchecks/3.1.2/metrics-healthchecks-3.1.2.pom
...

BUILD SUCCESSFUL

Total time: 2 mins 58.204 secs

Uploading your application code.
 This may take several minutes depending on your connection speed...
Uploading build/libs/21points-0.1-SNAPSHOT.war....

=== Monitoring and Analytics


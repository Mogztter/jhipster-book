When I started writing this book, I had a few different ideas for a sample application. My first idea involved creating
a photo gallery to showcase the 1996 VW Bus I've been working on for over 10 years. The project is almost finished and
I wanted a website to show how things have progressed through the years. I also thought about creating a blog application.
As part of http://raibledesigns.com/rd/entry/getting_hip_with_jhipster_at[my first presentation on JHipster] (at Denver's
Java User Group), I created a blog application that I live-coded to the audience. After that presentation, I spent
several hours polishing the application and started http://www.jhipster-book.com[www.jhipster-book.com] with it.

After thinking about the VW Bus Gallery and developing the blog application, I thought to myself "is this hip enough?"
Shouldn't a book about becoming a Java Hipster show how to build a hip application?

I wrote to Julien Dubois, founder of JHipster, and Dennis Sharpe, the technical editor for this book and asked them
their thoughts. We went back and forth on a few ideas: a gitter.im clone, a job board for Java hipsters, a shopping cart
app. Then it hit me, there was an I'd been wanting to develop for a while.

It's basically an app that you can use to monitor their health. In late September through mid-October 2014, I'd done a
"sugar detox" where I stopped eating sugar, started exercising regularly and stopped drinking alcohol. I'd had high blood
pressure for over 10 years and was on blood pressure medication at the time. During the first week of the detox, I ran
out of blood pressure medication. Since getting a new prescription required a doctors visit, I decided I'd wait until
after the detox to do so. After three weeks, not only did I lose 15 pounds, but my blood pressure was at normal levels!

Before I started the detox, I came up with a 21-point system to see how healthy I was being each week. Its rules were
simple: you can earn up to three points per day, for the following reasons:

1. If you eat healthy, you get a point. Otherwise, zero.
2. If you exercise, you get a point.
3. If you don't drink alcohol, you get a point.

I was surprised to find I got eight points the first week I used this system. During the detox, I got 16 points the
first week, 20 the second and 21 the third. Before the detox, I thought eating healthy meant eating anything but
fast food. After the detox, I realized that _eating healthy_ meant eating no sugar for me. I'm also a big craft
beer lover, so I've modified the alcohol rule to allow two healthier alcohol drinks per day (like a greyhound or
red wine).

My point goal per week is 15. I find that if I get above it, I'll likely lose weight and have good blood pressure. If I
get below 15, I risk getting sick. I've been tracking my health like this since September 2014. I've lost 30 pounds and
my blood pressure has returned to normal levels. I haven't had good blood pressure since my early 20s, so this has been
a life-changer for me.

I thought writing a "21-Point Health" application this would be hip because tracking your health is becoming more
important. With wearables that can track it for you, I might be able to create some APIs or hooks that can auto-record
points for a day. Imagine hooking into dailymile.com (where I track my exercise) or Untappd (where I sometimes checkin
the beers I drink). Or even displaying other activities for a day (e.g. showing your blood pressure score that you keep on
bettir.com).

I thought it'd fit nicely with JHipster and Spring Boot from a monitoring standpoint. Spring Boot has lots of health
monitors for your app, now you can use this JHipster app to monitor your health!

This chapter has five different sections:

1. Creating the application.
2. Building the UI and business logic.
3. Load Testing.
4. Deployment.
5. Monitoring and Analytics.

////
#3-5 are covered in Chapter 5 as well, not sure if they should be covered here.
////

=== Creating the application

I started using the http://jhipster.github.io/installation.html[Installing JHipster] instructions. I'm a Java Developer,
so I already had Java 8 installed, as well as Maven and Git. I installed Node.js from https://nodejs.org/[nodejs.org], then
ran the following commands to install http://yeoman.io/[Yeoman] and http://bower.io/[Bower].

[source]
----
npm install -g yo
npm install -g bower
----

I also installed Grunt and JHipster.

[source]
----
npm install -g grunt-cli
npm install -g generator-jhipster
----

Then I proceeded to build my application. Unlike many application generators in Javaland, Yeoman expects you to be
in the directory you want to create your project in, rather than creating the directory for you. So I created a `21-points`
directory and typed in the following command to invoke JHipster.

[source]
----
yo jhipster
----

After running this command, I was prompted to answer questions about how I wanted my application to be generated. You can
see the choices I made in <<img-generating-21points>>.

[[img-generating-21points]]
.Generating the application
image::chapter2/generating-21points.png[Generating the application, 1416, scaledwidth="100%"]

You can see that I chose PostgreSQL as my development and production database. The reason I did this is because using a
non-embedded database (like H2) offers some important benefits.

* Your data is retained when restarting the application.
* Your application starts a bit faster.
* You can use Liquibase to generate a database changelog.

http://www.liquibase.org/[Liquibase] is described as source control for your database. It will help create new fields as
you add them to your entities. It will also refactoring your database, for example creating tables and dropping columns.
It also has the ability to undo changes to your database, either automatically or with custom SQL.

After answering all the questions, JHipster created a whole bunch of files (272 in this case), then ran `npm install`
followed by `bower install`. To prove everything was good-to-go, I ran the unit tests using `grunt test`.

Next, I installed http://postgresapp.com/[Postgres.app] and tried creating a local PostgreSQL database. You can see in
<<img-create-local-db>> that PostgreSQL didn't like the numbers that started my database name.

[[img-create-local-db]]
.Creating local database
image::chapter2/creating-local-db.png[Creating local database, 1686, scaledwidth="100%"]

// MR: Would this be better as a code listing? Then people could copy and paste.

I chose the name _health_ instead and updated `src/main/resources/config/application-dev.yml` to use this name and the
specified credentials.

[source,diff]
----
     datasource:
         dataSourceClassName: org.postgresql.ds.PGSimpleDataSource
-        url:
-        databaseName: 21points
-        serverName: localhost
-        username: 21points
-        password:
+        url: jdbc:postgresql://localhost/health
+        username: health
+        password: health
----

==== Adding Source Control

One of the first things I like to do when creating a new project is to add it to a Version Control System (VCS). In this
particular case, I chose Git and Bitbucket. The following commands show how I initialized Git, committed the project,
added a reference to the remote Bitbucket repository, then pushed everything.

[source]
----
[mraible:~/dev/21-points] 128 $ git init
Initialized empty Git repository in /Users/mraible/dev/21-points/.git/

[mraible:~/dev/21-points] $ git add -A

[mraible:~/dev/21-points] $ git commit -m "Initial checkin of 21-points application"
[master (root-commit) c20f856] Initial checkin of 21-points application
 274 files changed, 13179 insertions(+)
 ...

[mraible:~/dev/21-points] $ git push origin master
Counting objects: 382, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (353/353), done.
Writing objects: 100% (382/382), 242.01 KiB | 0 bytes/s, done.
Total 382 (delta 55), reused 0 (delta 0)
To git@bitbucket.org:mraible/21-points.git
 * [new branch]      master -> master
----

This section showed you how I created a new application with JHipster and checked it into source control. If you're
creating an application following similar steps, I believe there's two common approaches for continuing. The first
involves developing the application, then testing and deploying. The second option is to setup continuous integration,
deploy, then begin development and testing. In a team development environment, I recommend following the second option.
However, since you're likely reading this as an individual, I'll follow the first approach and get right to coding.
If you're interested in setting up continuous integration with Jenkins, please see
http://www.jhipster-book.com/#!/news/entry/building-and-deploying-a-jhipster-app-with-jenkins[Building and Deploying a JHipster App with Jenkins].

=== Building the UI and business logic
I wanted 21 Points to be a bit more hip than a stock JHipster application. Bootstrap was all the rage a couple years ago,
but now Google's https://www.google.com/design/[Material Design] is growing in popularity. I searched and found a
https://fezvrasta.github.io/bootstrap-material-design/[Material Design for Bootstrap] theme. To install it, I executed
the following command:

[source]
----
bower install bootstrap-material-design --save
----

After this completed, I ran `grunt wiredep` to add the new CSS and JavaScript dependencies to `src/main/webapp/index.html`.
The https://github.com/taptapship/wiredep[wiredep] task updates files that refer to Bower dependencies for you. In this case,
`src/main/webapp/index.html` and `src/test/javascript/karma.conf.js`.

Then I followed the theme's Getting Started guide and added the following initialization code to the bottom of the page.

[source,html]
----
<script>
    $.material.init()
</script>
----

Finally, I ran `./gradlew bootRun` and confirmed the new theme was being used.

[[img-material-design-theme]]
.Material Design for Bootstrap Theme
image::chapter2/material-design-theme.png[Material Design for Bootstrap, 2492, scaledwidth="100%"]

Before creating the entities and associated database tables for this application, I decided to upgrade JHipster to
the latest release. You can see that I created this application with JHipster 2.16.0. The latest release is now
2.19.0, so I updated my version with the following command.

----
npm update -g generator-jhipster
----

This installs the latest version of JHipster, but does nothing to upgrade my project. I had to run the following
command to update the project.

----
yo jhipster
----

This notified me that it was deleting a number of files, and there were some conflicts in my files.footnote:[If you
don't see conflicts when upgrading, it's possible you never installed JHipster on the machine you're using. I found
this when switching machines. Check `package.json` to ensure it has the new version number. If it does not, run \
`npm install -g generator-jhipster`.]

----
This is an existing project, using the configuration from your .yo-rc.json file
to re-generate the project...

Remove the file - src/test/javascript/spec/app/account/health/healthControllerSpec.js
Remove the file - src/test/javascript/spec/app/account/login/loginControllerSpec.js
Remove the file - src/test/javascript/spec/app/account/password/passwordControllerSpec.js
Remove the file - src/test/javascript/spec/app/account/password/passwordDirectiveSpec.js
Remove the file - src/test/javascript/spec/app/account/sessions/sessionsControllerSpec.js
Remove the file - src/test/javascript/spec/app/account/settings/settingsControllerSpec.js
Remove the file - src/test/javascript/spec/components/auth/authServicesSpec.js
 conflict bower.json
? Overwrite bower.json? (Ynaxdh)
----

I answered "Y" to all the conflict questions. Because I had the files in source control, I was able to diff the changes
after they were made and decide if I wanted them or not. Most changes were welcome, but I wanted to keep my theme changes,
so I had to add the following back into `bower.json` and run `bower install` again.

[source,javascript]
----
"bootstrap-material-design": "~0.3.0"
----

I still needed to manually restore the call to initialize the Material Design theme at the bottom of `index.html`.

[source,html]
----
<script>
    $.material.init()
</script>
----

I ran `grunt serve` to verify everything looked good and committed my updated project into Git.

=== Load Testing
=== Deploy it!

[mraible:~/dev/21-points] 2s $ heroku login
Enter your Heroku credentials.
Email: matt@raibledesigns.com
Password (typing will be hidden):
Authentication successful.
⌁23% [mraible:~/dev/21-points] 18s $ yo jhipster:heroku
Heroku configuration is starting
? Name to deploy as: 21points
? On which region do you want to deploy ? us

Using existing Git repository

Installing Heroku CLI deployment plugin
Installing https://github.com/heroku/heroku-deploy...
done


Creating Heroku application and setting up node environment
heroku create 21points --addons heroku-postgresql:hobby-dev
✖ { [Error: Command failed: /bin/sh -c heroku create 21points --addons heroku-postgresql:hobby-dev
 !    Name must start with a letter and can only contain lowercase letters, numbers, and dashes.
]
  killed: false,
  code: 1,
  signal: null,
  cmd: '/bin/sh -c heroku create 21points --addons heroku-postgresql:hobby-dev' }
⌁22% [mraible:~/dev/21-points] 13s $ yo jhipster:heroku
Heroku configuration is starting
? Name to deploy as: health
? On which region do you want to deploy ? us

Using existing Git repository

Installing Heroku CLI deployment plugin
Installing https://github.com/heroku/heroku-deploy...
done


Creating Heroku application and setting up node environment
heroku create health --addons heroku-postgresql:hobby-dev

? The Heroku app "health" already exists! Use it anyways?
❯ Yes, I have access to it
  No, generate a random name

⌁22% [mraible:~/dev/21-points] 32s $ yo jhipster:heroku
Heroku configuration is starting
? Name to deploy as: 21-point-health
? On which region do you want to deploy ? us

Using existing Git repository

Installing Heroku CLI deployment plugin
Installing https://github.com/heroku/heroku-deploy...
^C
⌁22% [mraible:~/dev/21-points] 26s 130 $ yo jhipster:heroku
Heroku configuration is starting
? Name to deploy as: health-by-points
? On which region do you want to deploy ? us

Using existing Git repository

Installing Heroku CLI deployment plugin
Installing https://github.com/heroku/heroku-deploy...
done


Creating Heroku application and setting up node environment
heroku create health-by-points --addons heroku-postgresql:hobby-dev
Creating health-by-points... done, stack is cedar-14

Adding heroku-postgresql:hobby-dev to health-by-points...
done

https://health-by-points.herokuapp.com/ | https://git.heroku.com/health-by-points.git

Git remote heroku added


Creating Heroku deployment files

Building application
:generateMainMapperClasses

Download https://oss.sonatype.org/content/repositories/releases/io/dropwizard/metrics/metrics-healthchecks/3.1.2/metrics-healthchecks-3.1.2.pom
...

BUILD SUCCESSFUL

Total time: 2 mins 58.204 secs

Uploading your application code.
 This may take several minutes depending on your connection speed...
Uploading build/libs/21points-0.1-SNAPSHOT.war....

=== Monitoring and Analytics


=== Spring Boot

//image::images/chapter4/spring-boot-logo.png[Spring Boot Logo, 150, 150, float="right"]

In August 2013, the Phil Webb and Dave Syer, Engineers at Pivotal,
https://spring.io/blog/2013/08/06/spring-boot-simplifying-spring-for-everyone[announced the first milestone release] of Spring
Boot. Spring Boot makes it easy to create Spring applications with minimal effort. It takes an opinionated
view of Spring and auto-configures dependencies for you. This allows you to write less code, but still harness
the power of Spring. The diagram below shows how Spring Boot is the gateway to the larger Spring ecosystem.

[[img-spring-boot-pyramid]]
.Spring Boot
image::images/chapter4/spring-boot-pyramid.png[Spring Boot, 379, scaledwidth="50%", align=center]

The primary goals of Spring Boot are:

* To provide a radically faster and widely accessible 'getting started' experience for all Spring development.
* To be opinionated out of the box, but get out of the way quickly as requirements start to diverge from the defaults.
* To provide a range of non-functional features that are common to large classes of projects
  (e.g. embedded servers, security, metrics, health checks, externalized configuration).

For folks wanting to use Spring Boot outside of a JHipster application, this can be done by using Spring Initializr.
Spring Initializr is a configurable service for generating Spring projects. It's both a web application and a REST API.
You can visit it in your browser at https://start.spring.io or you can call it via `curl`.

[[img-spring-initializr-web]]
.Spring Initializr in a browser
image::images/chapter4/spring-initializr-web.png[Spring Initializr in a browser, 1248, scaledwidth="100%"]

[[img-spring-initializr-curl]]
.Spring Initializr via curl
image::images/chapter4/spring-initializr-curl.png[Spring Initializr via curl, 1082, scaledwidth="100%"]

Spring Initializr is an Apache 2.0-licensed open source project that install and customize for generating Spring
projects for your company or team. You can find it on GitHub at https://github.com/spring-io/initializr.

Spring Initializr is also available in the Eclipse-based https://spring.io/tools/sts[Spring Tool Suite (STS)] and
https://www.jetbrains.com/idea/[IntelliJ IDEA].

.Spring CLI
****
At the bottom of the start.spring.io page, you can also download or install the Spring CLI (also called the Spring Boot CLI).
The easiest way to install it is using the following command.

----
curl https://start.spring.io/install.sh | sh
----

Spring CLI is best used for rapid prototyping; when you want to show someone how to do something _very_ quickly, and you'll
likely throw away the code when you're done. For example, if you want to create a "Hello World" web application in Groovy,
you can do it with seven lines of code.

[source,groovy]
.hello.groovy
----
@RestController
class WebApplication {
    @RequestMapping("/")
    String home() {
        "Hello World!"
    }
}
----

To compile and run this application, simply type:

----
spring run hello.groovy
----

After running this command, you can see the application at http://localhost:8080. For more information about the
Spring CLI, see the http://docs.spring.io/spring-boot/docs/current/reference/html/cli-using-the-cli.html[Spring Boot documentation].
****

To show you how to create a simple application with Spring Boot, go to https://start.spring.io and select `Web`, `JPA`,
`H2` and `Actuator` as project dependencies. Click *Generate Project* to download a .zip file for your project. Extract
it onto your hard drive and import it into your favorite IDE.

This project has only a few files in it, as you can see by running the `tree` command (on *nix).

----
.
├── pom.xml
└── src
    ├── main
    │   ├── java
    │   │   └── demo
    │   │       └── DemoApplication.java
    │   └── resources
    │       ├── application.properties
    │       ├── static
    │       └── templates
    └── test
        └── java
            └── demo
                └── DemoApplicationTests.java

10 directories, 4 files
----

`DemoApplication.java` is the heart of this application, the file and class name are not relevant. What is relevant
is the `@SpringBootApplication` annotation and the classes `public static void main`.

[source,java]
.src/main/java/demo/DemoApplication.java
----
package demo;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class DemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }
}
----

For this application, you'll create an entity, a JPA repository and a REST endpoint to show data in the browser. To
create an entity, add the following code to the `DemoApplication.java` file, outside of the `DemoApplication` class.

[source,java]
.src/main/java/demo/DemoApplication.java
----
@Entity
class Blog {

    @Id
    @GeneratedValue
    private Long id;
    private String name;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    @Override
    public String toString() {
        return "Blog{" +
                "id=" + id +
                ", name='" + name + '\'' +
                '}';
    }
}
----

In the same file, add a `BlogRepository` interface that extends `JpaRepository`. Spring Data JPA makes it really easy to
create a CRUD repository for an entity. The implementation that talks to the underlying datastore is created automatically for you.

[source,java]
.src/main/java/demo/DemoApplication.java
----
interface BlogRepository extends JpaRepository<Blog, Long> {}
----

Define a `CommandLineRunner` that injects this repository and prints out all the data that's found by calling its `findAll()` method.
`CommandLineRunner` is an interface that's used to indicate that a bean should run when it is contained within a
http://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/SpringApplication.html[`SpringApplication`].

[source,java]
.src/main/java/demo/DemoApplication.java
----
@Component
class BlogCommandLineRunner implements CommandLineRunner {

    @Override
    public void run(String... strings) throws Exception {
        System.out.println(repository.findAll());
    }

    @Autowired
    private BlogRepository repository;
}
----

To provide default data, create `src/main/resources/data.sql` and add a couple SQL statements to insert data.

[source,sql]
.src/main/resources/data.sql
----
insert into blog (name) values ('First');
insert into blog (name) values ('Second');
----

Start your application with `mvn spring-boot:run` (or right-click -> run in your IDE) and you should see this default
data show up in your logs.

----
2015-09-21 06:00:07.056  INFO 6140 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http)
[Blog{id=1, name='First'}, Blog{id=2, name='Second'}]
2015-09-21 06:00:07.210  INFO 6140 --- [           main] demo.DemoApplication                     : Started DemoApplication in 4.794 seconds (JVM running for 5.238)
----

To publish this data as a REST API, create a `BlogController` class and add a `/blogs` endpoint that returns a list of blogs.

[source,java]
.src/main/java/demo/DemoApplication.java
----
@RestController
class BlogController {

    @RequestMapping("/blogs")
    Collection<Blog> list() {
        return repository.findAll();
    }

    @Autowired
    BlogRepository repository;
}
----

After adding this code and restarting the application, you can `curl` the endpoint or open it in your
favorite browser.

----
$ curl localhost:8080/blogs
[{"id":1,"name":"First"},{"id":2,"name":"Second"}]
----

Spring has one of the best track records for hipness in JavaLand. It is an essential cornerstone of the solid API foundation
that makes JHipster awesome. Spring Boot allows you to create stand-alone Spring applications that embed Tomcat, Jetty or
Undertow directly. It provides opinionated _starter_ dependencies that simplify your build configuration, regardless of
whether you're using Maven or Gradle.

Spring Boot is unique in that it automatically configures Spring whenever possible. It does this by peaking into JAR
files to see if they're hip. If they are, they contain a `META-INF/spring.factories` that defines configuration classes
under the `EnableAutoConfiguration` key. For example:

----
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.jhipster.beer.autoconfigure.PBRAutoConfiguration,\
org.jhipster.beer.autoconfigure.PRRDrinkingAutoConfiguration
----

These configuration classes will usually contain `@Conditional` annotations to help configure themselves. Using
`@ConditionalOnMissingBean` is used commonly to allow developers to override the auto-configured defaults. There are several
conditional-related annotations you can use when developing Spring Boot plugins:

* `@ConditionalOnClass` and `@ConditionalOnMissingClass`
* `@ConditionalOnMissingClass` and `@ConditionalOnMissingBean`
* `@ConditionalOnProperty`
* `@ConditionalOnResource`
* `@ConditionalOnWebApplication` and `@ConditionalOnNotWebApplication`
* `@ConditionalOnExpression`

These annotations are what gives Spring Boot its immense power and makes it easy to use, configure and override.

==== Actuator
Spring Boot's Actuator sub-project adds several production-grade services to your application with little effort.
You can add the actuator to a Maven-based project by adding the `spring-boot-starter-actuator` dependency.

----
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-actuator</artifactId>
    </dependency>
</dependencies>
----

If you're using Gradle, you'll save a few lines:

----
dependencies {
    compile("org.springframework.boot:spring-boot-starter-actuator")
}
----

Actuator's main features are *endpoints*, *metrics*, *auditing*, and *process monitoring*. Actuator auto-creates a
number of REST endpoints. By default Spring Boot will also expose management endpoints as JMX MBeans under the
`org.springframework.boot` domain. Actuator REST endpoints include:

* `/autoconfig` - Returns an auto-configuration report showing all auto-configuration candidates.
* `/beans` - Returns a complete list of all the Spring beans in your application.
* `/configprops` - Returns a list of all @ConfigurationProperties.
* `/dump` - Performs a thread dump.
* `/env` - Returns properties from Spring's ConfigurableEnvironment.
* `/health` - Returns application health information.
* `/info` - Returns basic application info.
* `/metrics` - Returns performance information for the current application.
* `/mappings` - Returns a  list of all `@RequestMapping` paths.
* `/shutdown` - Shuts the application down gracefully (not enabled by default).
* `/trace` - Returns trace information (by default the last several HTTP requests).

JHipster includes a plethora of Spring Boot starter dependencies by default. This allows developers write less code and worry
less about dependencies and classpaths. The _boot starter_ dependencies in the 21 Points Health application are as follows:

----
spring-boot-actuator
spring-boot-autoconfigure
spring-boot-loader-tools
spring-boot-starter-logging
spring-boot-starter-aopspring-boot-starter-data-jpa
spring-boot-starter-data-elasticsearch
spring-boot-starter-security
spring-boot-starter-web
spring-boot-starter-websocket
spring-boot-starter-thymeleaf
spring-cloud-cloudfoundry-connector
spring-cloud-spring-service-connector
spring-cloud-localconfig-connector
spring-security-config
spring-security-data
spring-security-web
spring-security-messaging
----

Spring Boot does a great job at auto-configuring libraries and simplifying Spring. JHipster complements that by
integrating the wonderful world of Spring Boot with a modern UI and developer experience.

=== Maven vs. Gradle

Maven and Gradle are the two main build tools used in Java projects today.

http://maven.apache.org/[Apache Maven] calls itself a software project management and comprehension tool. Based on the
concept of a project object model (POM), Maven can manage a project's build, reporting and documentation from a
central piece of information. Most of Maven's functionality is in plugins. There are Maven plugins for building,
testing, source control management, running a web server, generating IDE project files, and much more.

https://gradle.org/[Gradle] is a general-purpose build tool. It can build pretty much anything you care to implement
in your build script. Out-of-the-box, however, it doesn't build anything unless you add code to your build script to
do so. Gradle has a Groovy-based domain-specific language (DSL) instead of the more traditional XML form of declaring
the project configuration. Like Maven, Gradle has _plugins_ that allow you to configure tasks for your project. Most
plugins add some pre-configured tasks which together do something useful. For example, Gradle's Java plugin
adds some tasks to your project which will compile and unit test your Java source code, and bundle it into a JAR file.

http://zeroturnaround.com/rebellabs/java-build-tools-part-2-a-decision-makers-comparison-of-maven-gradle-and-ant-ivy/

https://gradle.org/maven_vs_gradle/

http://technologyconversations.com/2014/06/18/build-tools/

http://www.drdobbs.com/jvm/why-build-your-java-projects-with-gradle/240168608

http://docs.spring.io/spring-boot/docs/current/reference/html/build-tool-plugins-maven-plugin.html
http://docs.spring.io/spring-boot/docs/current/reference/html/build-tool-plugins-gradle-plugin.html

=== IDE Support: Running, Debugging and Profiling

https://books.google.com/books?id=Pu53CgAAQBAJ&pg=PA258&lpg=PA258&dq=spring+initializr+netbeans&source=bl&ots=Bj-0d1AyZy&sig=D2A-eg7Gh6ssNiAD5LMQhDMsPqg&hl=en&sa=X&ved=0CCkQ6AEwAmoVChMIwIiZpISIyAIViU6SCh2GMA5C#v=onepage&q=spring%20initializr%20netbeans&f=false
https://blogs.oracle.com/geertjan/entry/new_spring_boot_integration_for

https://www.jetbrains.com/idea/help/creating-spring-boot-projects.html

=== Security

Spring Security is fucking bad ass

// Include simple Spring Security config and example

=== JPA vs. MongoDB vs. Cassandra

RDMS vs NoSQL

=== Liquibase

Database diffs rock!

=== Elasticsearch

What is is? Why is it awesome?

==== Deployment

https://spring.io/blog/2014/03/07/deploying-spring-boot-applications


